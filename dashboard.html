<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Requests - Rolling Translations</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="container">
        <img src="images/logo.png" alt="Rolling Translations Logo" class="logo" />
        <h1>Your Translation Requests</h1>
        <table id="requestsTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Languages</th>
                    <th>File</th>
                    <th>Status</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                <!-- Requests will be inserted here -->
            </tbody>
        </table>
        <button id="logoutBtn">Log out</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-auth.js";
        import { getFirestore, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBYjq_CaTEfFhfTChfJ6SnXSbgIzbbRHHc",
            authDomain: "rollingtranslationsportal.firebaseapp.com",
            projectId: "rollingtranslationsportal",
            storageBucket: "rollingtranslationsportal.firebasestorage.app",
            messagingSenderId: "492156326175",
            appId: "1:492156326175:web:14175badae2bbaada0e02a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const tableBody = document.querySelector("#requestsTable tbody");

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = "index.html";
                return;
            }

            const q = query(
                collection(db, "projectRequests"),
                where("email", "==", user.email),
                orderBy("createdAt", "desc")
            );

            const snapshot = await getDocs(q);
            snapshot.forEach((doc) => {
                const data = doc.data();
                const date = data.createdAt?.toDate().toLocaleString() ?? "N/A";
                const langs = `${data.sourceLang} â†’ ${data.targetLang}`;
                const file = data.file || "â€”";
                const status = data.status || "ðŸ•’ Pending";
                const notes = data.notes || "â€”";

                const row = document.createElement("tr");
                row.innerHTML = `
          <td>${date}</td>
          <td>${langs}</td>
          <td>${file}</td>
          <td>${status}</td>
          <td>${notes}</td>
        `;
                tableBody.appendChild(row);
            });
        });

        document.getElementById("logoutBtn").addEventListener("click", () => {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        });
    </script>
</body>

</html>